<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sudoku Pro</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin:0; padding:4px; }
    .container { background: #fff; padding:12px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.1); max-width:600px; margin:auto; text-align:center; position:relative; }
    h2 { margin:8px 0; }
    .menu { display:flex; flex-wrap:wrap; justify-content:center; gap:6px; margin:8px 0; }
    .menu button, .number-pad button { border:none; border-radius:6px; background-color: var(--main-color); color:#fff; cursor:pointer; font-size:14px; padding:6px; }
    .menu button:hover, .number-pad button:hover { background-color: var(--hover-color); }
    .grid { display:grid; grid-template-columns: repeat(9,1fr); gap:2px; margin:12px auto; }
    .cell { position:relative; background:#fff; border:1px solid #ccc; aspect-ratio:1/1.2; display:flex; align-items:center; justify-content:center; font-size:5vw; cursor:pointer; }
    .cell.prefilled { background:#e0e0e0; cursor:default; }
    .cell.selected { background:#add8e6; }
    /* candidates */
    .cell .candidates { position:absolute; top:2px; left:2px; font-size:10px; color:#666; line-height:1.2; white-space:pre-wrap; text-align:left; width:100%; }
    /* Bold block borders */
    .cell:nth-child(3n+1) { border-left:3px solid #000; }
    .cell:nth-child(-n+9) { border-top:3px solid #000; }
    .cell:nth-child(3n) { border-right:3px solid #000; }
    .cell:nth-child(n+73) { border-bottom:3px solid #000; }
    #timer { font-weight:bold; margin:0 8px; }
    .number-pad { display:flex; flex-wrap:wrap; justify-content:center; gap:6px; margin-top:8px; }
    /* theme */
    :root { --main-color:#2a82da; --hover-color:#1c64b1; }
    body[data-theme='green'] { --main-color:#28a745; --hover-color:#1e7e34; }
    body[data-theme='orange'] { --main-color:#fd7e14; --hover-color:#e8590c; }
    body.dark { background:#1e1e1e; color:#fff; }
    body.dark .container { background:#2e2e2e; }
    body.dark .cell { background:#3e3e3e; border-color:#666; }
    body.dark .cell.prefilled { background:#555; }
    body.dark .cell.selected { background:#777; }
  </style>
</head>
<body data-theme="blue">
  <div class="container">
    <h2>Sudoku Pro - <span id="difficulty-title">Facile</span></h2>
    <div class="menu">
      <button onclick="toggleDarkMode()">üåì</button>
      <div id="timer">00:00</div>
      <button onclick="printGrid()">üñ®Ô∏è</button>
    </div>
    <div class="menu">
      <select id="theme-select" onchange="updateTheme()">
        <option value="blue">Bleu</option>
        <option value="green">Vert</option>
        <option value="orange">Orange</option>
      </select>
      <select id="difficulty-select">
        <option value="easy">Facile</option>
        <option value="medium">Moyen</option>
        <option value="hard">Difficile</option>
        <option value="expert">Expert</option>
      </select>
      <button onclick="startGame()">Nouvelle grille</button>
    </div>
    <div class="grid" id="sudoku-grid"></div>
    <div id="steps" style="font-size:12px; text-align:left; max-height:150px; overflow-y:auto; margin-top:8px;"></div>
    <div class="number-pad">
      <button onclick="enterNumber(1)">1</button>
      <button onclick="enterNumber(2)">2</button>
      <button onclick="enterNumber(3)">3</button>
      <button onclick="enterNumber(4)">4</button>
      <button onclick="enterNumber(5)">5</button>
      <button onclick="enterNumber(6)">6</button>
      <button onclick="enterNumber(7)">7</button>
      <button onclick="enterNumber(8)">8</button>
      <button onclick="enterNumber(9)">9</button>
      <button onclick="clearEntry()">‚úñ</button>
    </div>
  </div>
  <script>
    const SIZE=9;
    let grid=[], solution=[], selected=null, timerInt, startTime, stepsEl=document.getElementById('steps');
    function init(){startGame();}
    function startGame(){
      clearInterval(timerInt);
      document.getElementById('difficulty-title').textContent=
        document.getElementById('difficulty-select').value.charAt(0).toUpperCase()+document.getElementById('difficulty-select').value.slice(1);
      grid=generateSudoku(document.getElementById('difficulty-select').value);
      solution=grid.map(r=>[...r]); solve(solution);
      render(); stepsEl.innerHTML='';
      startTime=Date.now();
      timerInt=setInterval(()=>{let d=Date.now()-startTime,m=Math.floor(d/60000),s=Math.floor((d%60000)/1000);
        document.getElementById('timer').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;},500);
    }
    function render(){
      const el=document.getElementById('sudoku-grid'); el.innerHTML='';
      grid.forEach((r,i)=>r.forEach((v,j)=>{
        let c=document.createElement('div'); c.className='cell'+(v?' prefilled':'')+(selected===i*9+j?' selected':'');
        c.textContent=v||''; c.dataset.idx=i*9+j;
        if(!v) c.onclick=()=>{selected=c.dataset.idx;render();};
        el.appendChild(c);
      }));
    }
    function solve(g){for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)if(g[r][c]===0){
        for(let n=1;n<=9;n++)if(isValid(g,r,c,n)){g[r][c]=n; if(solve(g))return true; g[r][c]=0;} return false;}return true;}
    function isValid(g,r,c,n){
      for(let i=0;i<SIZE;i++)if(g[r][i]===n||g[i][c]===n)return false;
      let br=3*Math.floor(r/3),bc=3*Math.floor(c/3);
      for(let i=br;i<br+3;i++)for(let j=bc;j<bc+3;j++)if(g[i][j]===n)return false;
      return true;
    }
    function shuffleSudoku(g){
      for(let i=0;i<20;i++){
        let r1=Math.floor(Math.random()*9),r2=Math.floor(Math.random()*9);
        [g[r1],g[r2]]=[g[r2],g[r1]];
      }
    }
    function generateSudoku(level){
      let g=Array.from({length:9},()=>Array(9).fill(0));
      solve(g); shuffleSudoku(g); shuffleSudoku(g);
      let ranges={easy:[22,30],medium:[30,40],hard:[40,50],expert:[50,60]};
      let [min,max]=ranges[level]||ranges.easy;
      let toRemove=Math.floor(Math.random()*(max-min+1))+min;
      let pos=[...Array(81).keys()].sort(()=>Math.random()-.5);
      pos.slice(0,toRemove).forEach(idx=>g[Math.floor(idx/9)][idx%9]=0);
      return g;
    }
    function enterNumber(n){
      if(selected==null)return;
      let r=Math.floor(selected/9),c=selected%9;
      if(!grid[r][c]){grid[r][c]=n; render();}
    }
    function clearEntry(){selected=null; render();}
    function printGrid(){window.print();}
    function toggleDarkMode(){document.body.classList.toggle('dark');}
    function updateTheme(){document.body.setAttribute('data-theme',document.getElementById('theme-select').value);}
    window.onload=init;
  </script>
</body>
</html>
